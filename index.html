<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hawkvibes Performance Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { 
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* bg-slate-50 */
            color: #1e293b; /* text-slate-800 */
            margin: 0;
            padding: 20px;
        }
        /* Custom range slider styling */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
        }
        input[type=range]:focus {
            outline: none; 
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="flex flex-col items-center">

    <div class="w-full max-w-4xl">
        
        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-2xl font-bold text-slate-900">Compliance Performance review Calculator</h1>
            <p class="text-sm text-slate-500">Compliance Performance Framework</p>
        </div>

        <!-- Workflow Toggle -->
        <div class="flex justify-center mb-6">
            <div class="bg-white p-1 rounded-lg shadow-sm border border-slate-200 inline-flex">
                <button onclick="switchWorkflow('kyc')" id="tab-kyc" class="px-5 py-2 rounded-md text-sm font-bold transition-all bg-indigo-600 text-white shadow-sm">
                    <i class="fa-solid fa-user-check mr-2"></i> KYC / Onboarding
                </button>
                <button onclick="switchWorkflow('monitoring')" id="tab-monitoring" class="px-5 py-2 rounded-md text-sm font-bold transition-all text-slate-500 hover:bg-slate-50">
                    <i class="fa-solid fa-bell mr-2"></i> Monitoring / Alerts
                </button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
            
            <!-- Input Section -->
            <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border border-slate-200 p-5">
                <h2 class="text-lg font-bold mb-4 flex items-center text-indigo-700" id="inputsTitle">
                    <i class="fa-solid fa-sliders mr-2"></i> KYC Inputs
                </h2>

                <!-- 1. QA Score Input (Universal) -->
                <div class="mb-6 border-b border-slate-100 pb-4">
                    <label class="block text-sm font-bold text-slate-700 mb-2">1. Quarterly QA Score (%)</label>
                    <div class="flex items-center space-x-3">
                        <input type="range" id="qaInput" min="0" max="100" value="90.0" step="0.1" 
                            class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600">
                        <div class="w-20">
                            <input type="number" id="qaNumber" value="90.0" min="0" max="100" step="0.1"
                                class="w-full p-1.5 text-center border border-slate-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:outline-none font-bold text-indigo-700 text-base">
                        </div>
                    </div>
                    <div class="flex justify-between text-[10px] text-slate-400 mt-2 font-medium uppercase tracking-wider">
                        <span class="text-red-400">Critical</span>
                        <span class="text-orange-400">Below</span>
                        <span class="text-blue-400">Meets</span>
                        <span class="text-indigo-400">Exceeds</span>
                        <span class="text-purple-500">Best in Class</span>
                    </div>
                </div>

                <!-- 2. Team Multiplier Section -->
                <div class="mb-6 border-b border-slate-100 pb-4">
                    <label class="block text-sm font-bold text-slate-700 mb-2">2. Team Collective Measure</label>
                    
                    <!-- KYC Specific Input (UPDATED THRESHOLDS) -->
                    <div id="kycTeamInput" class="fade-in">
                        <p class="text-xs text-slate-500 mb-2">Metric: % of cases reviewed within 1 business day.</p>
                        <div class="relative">
                            <select id="teamTatInput" onchange="calculate();"
                                class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none bg-white font-medium text-sm appearance-none cursor-pointer hover:bg-slate-50 transition-colors">
                                <option value="0.5">Excellent: ≥ 80% Compliance (+0.5)</option>
                                <option value="0" selected>Target: 70% to 79.9% Compliance (0.0)</option>
                                <option value="-1.0">Poor: < 70% Compliance (-1.0)</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-slate-500">
                                <i class="fa-solid fa-chevron-down text-xs"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Monitoring Specific Input (2 SLAs) -->
                    <div id="monitoringTeamInput" class="hidden fade-in space-y-3">
                        <p class="text-xs text-slate-500 mb-1">Select the team's performance for BOTH targets (Target is ≥ 70%):</p>
                        
                        <div class="grid grid-cols-2 gap-3">
                            <!-- SLA 1 -->
                            <div class="p-2 bg-slate-50 rounded border border-slate-200">
                                <label class="block text-[10px] font-bold text-slate-500 mb-1 uppercase">A. Real-Time (12h)</label>
                                <div class="flex flex-col space-y-1">
                                    <label class="cursor-pointer">
                                        <input type="radio" name="sla1" value="met" class="peer sr-only" onchange="calculate()" checked>
                                        <div class="px-2 py-1 text-center text-xs rounded border border-slate-300 bg-white text-slate-500 peer-checked:bg-green-100 peer-checked:border-green-500 peer-checked:text-green-800 transition-all">
                                            <i class="fa-solid fa-check mr-1"></i> Met
                                        </div>
                                    </label>
                                    <label class="cursor-pointer">
                                        <input type="radio" name="sla1" value="missed" class="peer sr-only" onchange="calculate()">
                                        <div class="px-2 py-1 text-center text-xs rounded border border-slate-300 bg-white text-slate-500 peer-checked:bg-red-100 peer-checked:border-red-500 peer-checked:text-red-800 transition-all">
                                            <i class="fa-solid fa-xmark mr-1"></i> Missed
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <!-- SLA 2 -->
                            <div class="p-2 bg-slate-50 rounded border border-slate-200">
                                <label class="block text-[10px] font-bold text-slate-500 mb-1 uppercase">B. Retro. (10d)</label>
                                <div class="flex flex-col space-y-1">
                                    <label class="cursor-pointer">
                                        <input type="radio" name="sla2" value="met" class="peer sr-only" onchange="calculate()" checked>
                                        <div class="px-2 py-1 text-center text-xs rounded border border-slate-300 bg-white text-slate-500 peer-checked:bg-green-100 peer-checked:border-green-500 peer-checked:text-green-800 transition-all">
                                            <i class="fa-solid fa-check mr-1"></i> Met
                                        </div>
                                    </label>
                                    <label class="cursor-pointer">
                                        <input type="radio" name="sla2" value="missed" class="peer sr-only" onchange="calculate()">
                                        <div class="px-2 py-1 text-center text-xs rounded border border-slate-300 bg-white text-slate-500 peer-checked:bg-red-100 peer-checked:border-red-500 peer-checked:text-red-800 transition-all">
                                            <i class="fa-solid fa-xmark mr-1"></i> Missed
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Calculated Result Display -->
                        <div class="text-right text-xs font-bold text-indigo-600" id="monitoringTeamResult">
                            Multiplier: +0.5
                        </div>
                    </div>
                </div>
                
                <!-- 3. Individual Effort Multiplier -->
                <div class="mb-4">
                    <label class="block text-sm font-bold text-slate-700 mb-2">3. Individual Effort Multiplier</label>
                    <p class="text-xs text-slate-500 mb-2" id="effortDesc">Analyst's total raw case count relative to peer group.</p>
                    <div class="relative">
                        <select id="individualEffortInput" onchange="calculate();"
                            class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none bg-white font-medium text-sm appearance-none cursor-pointer hover:bg-slate-50 transition-colors">
                            <option value="1.0">Top Volume: Top 20% of peers (+1.0)</option>
                            <option value="0" selected>Standard Volume: Mid 60% of peers (0.0)</option>
                            <option value="-1.0">Low Volume: Bottom 20% of peers (-1.0)</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-slate-500">
                            <i class="fa-solid fa-chevron-down text-xs"></i>
                        </div>
                    </div>
                </div>

                <!-- Bonus Chance Checkbox (Conditional) -->
                <div id="bonusSection" class="hidden mt-4 bg-amber-50 border border-amber-200 p-3 rounded-lg animate-fade-in">
                    <div class="flex items-center">
                        <div class="bg-amber-100 p-1.5 rounded-full mr-3 text-amber-600">
                            <i class="fa-solid fa-star text-xs"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-xs font-bold text-amber-900">Bonus Eligibility (QA 85-89.9%)</h3>
                            <label class="flex items-center space-x-2 cursor-pointer mt-1">
                                <input type="checkbox" id="bonusCheck" class="w-4 h-4 text-amber-600 rounded focus:ring-amber-500 border-gray-300">
                                <span class="text-xs font-bold text-amber-900">Bonus Case Passed (100%)</span>
                            </label>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Result Section -->
            <div class="lg:col-span-1">
                <div class="bg-indigo-900 text-white rounded-xl shadow-lg p-6 h-full flex flex-col justify-between relative overflow-hidden ring-1 ring-white/10 min-h-[300px]">
                    
                    <!-- Background blobs -->
                    <div class="absolute top-0 right-0 -mr-16 -mt-16 w-64 h-64 bg-indigo-600 rounded-full blur-3xl opacity-20"></div>
                    <div class="absolute bottom-0 left-0 -ml-16 -mb-16 w-64 h-64 bg-purple-600 rounded-full blur-3xl opacity-20"></div>

                    <div class="relative z-10 text-center lg:text-left">
                        <h3 class="text-indigo-200 text-xs font-bold uppercase tracking-widest mb-1">Final Score</h3>
                        <div class="flex items-baseline justify-center lg:justify-start">
                            <span id="scoreDisplay" class="text-7xl font-bold tracking-tight">0</span>
                            <span class="text-2xl text-indigo-300 font-light opacity-60">/10</span>
                        </div>
                        
                        <div id="badgeContainer" class="mt-4 flex flex-wrap justify-center lg:justify-start gap-2">
                            <!-- Badges injected by JS -->
                        </div>
                        
                        <div id="workflowBadge" class="mt-4 p-1.5 bg-indigo-800/50 rounded text-[10px] text-indigo-200 border border-indigo-700/50 inline-block">
                            Mode: KYC
                        </div>
                    </div>

                    <div class="relative z-10 mt-6 border-t border-indigo-700/50 pt-4">
                        <h4 class="text-[10px] font-bold text-indigo-300 uppercase mb-2 tracking-wider">Breakdown</h4>
                        <ul class="space-y-2 text-xs text-indigo-100/90" id="logicList">
                            <!-- Logic steps injected by JS -->
                        </ul>
                    </div>

                    <!-- Best in Class Animation Container -->
                    <div id="unicornAnim" class="hidden absolute inset-0 bg-indigo-900/95 backdrop-blur-sm z-50 flex flex-col items-center justify-center text-center p-6 transition-opacity duration-500">
                        <div class="animate-bounce mb-4">
                            <i class="fa-solid fa-trophy text-5xl text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 to-amber-500"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-white mb-1 tracking-tight">BEST IN CLASS!</h2>
                        <p class="text-indigo-200 text-sm mb-6">Perfect 10 Achieved.</p>
                        <button onclick="closeUnicorn()" class="px-5 py-2 bg-white text-indigo-900 rounded-full text-xs font-bold hover:bg-indigo-50 transition-all shadow-lg">
                            Close
                        </button>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // State
        let currentWorkflow = 'kyc';

        // DOM Elements
        const tabKyc = document.getElementById('tab-kyc');
        const tabMonitoring = document.getElementById('tab-monitoring');
        const kycTeamInput = document.getElementById('kycTeamInput');
        const monitoringTeamInput = document.getElementById('monitoringTeamInput');
        const inputsTitle = document.getElementById('inputsTitle');
        const effortDesc = document.getElementById('effortDesc');
        const workflowBadge = document.getElementById('workflowBadge');
        const monitoringTeamResult = document.getElementById('monitoringTeamResult');

        const qaInput = document.getElementById('qaInput');
        const qaNumber = document.getElementById('qaNumber');
        const teamTatInput = document.getElementById('teamTatInput'); // KYC
        const individualEffortInput = document.getElementById('individualEffortInput');
        const bonusSection = document.getElementById('bonusSection');
        const bonusCheck = document.getElementById('bonusCheck');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const logicList = document.getElementById('logicList');
        const badgeContainer = document.getElementById('badgeContainer');
        const unicornAnim = document.getElementById('unicornAnim');
        
        // --- Workflow Switching ---
        function switchWorkflow(mode) {
            currentWorkflow = mode;
            
            if (mode === 'kyc') {
                // Style Tabs
                tabKyc.className = "px-5 py-2 rounded-md text-sm font-bold transition-all bg-indigo-600 text-white shadow-sm";
                tabMonitoring.className = "px-5 py-2 rounded-md text-sm font-bold transition-all text-slate-500 hover:bg-slate-50";
                
                // Show/Hide Inputs
                kycTeamInput.classList.remove('hidden');
                monitoringTeamInput.classList.add('hidden');
                
                // Update Labels
                inputsTitle.innerHTML = '<i class="fa-solid fa-sliders mr-2"></i> KYC Inputs';
                effortDesc.innerText = "Analyst's total raw case count relative to peer group.";
                workflowBadge.innerText = "Mode: KYC/Onboarding";
            } else {
                // Style Tabs
                tabMonitoring.className = "px-5 py-2 rounded-md text-sm font-bold transition-all bg-indigo-600 text-white shadow-sm";
                tabKyc.className = "px-5 py-2 rounded-md text-sm font-bold transition-all text-slate-500 hover:bg-slate-50";
                
                // Show/Hide Inputs
                kycTeamInput.classList.add('hidden');
                monitoringTeamInput.classList.remove('hidden');
                
                // Update Labels
                inputsTitle.innerHTML = '<i class="fa-solid fa-sliders mr-2"></i> Monitoring Inputs';
                effortDesc.innerText = "Analyst's total raw alert count relative to peer group.";
                workflowBadge.innerText = "Mode: Monitoring/Alerts";
            }
            calculate();
        }


        // --- Event Listeners ---
        qaInput.addEventListener('input', () => {
            qaNumber.value = qaInput.value;
            calculate();
        });
        qaNumber.addEventListener('input', () => {
            let val = parseFloat(qaNumber.value);
            if(val > 100) val = 100;
            if(val < 0) val = 0;
            qaInput.value = val;
            calculate();
        });
        bonusCheck.addEventListener('change', calculate);

        // --- Core Calculation ---
        function calculate() {
            // 1. Get QA
            let inputQA = parseFloat(qaNumber.value);
            let effectiveQA = inputQA;
            let bonusApplied = false;

            // 2. Bonus Chance Logic (85-89.9%)
            if (inputQA >= 85.0 && inputQA < 90.0) {
                bonusSection.classList.remove('hidden');
                if (bonusCheck.checked) {
                    effectiveQA = 90.0;
                    bonusApplied = true;
                }
            } else {
                bonusSection.classList.add('hidden');
                bonusCheck.checked = false;
            }

            // 3. Determine Base Score & Cap
            let baseScore = 0;
            let maxCap = 0;
            let bracketName = "";
            let bracketColor = "";
            let reasons = [];

            if (effectiveQA < 80.0) {
                baseScore = 4.0; maxCap = 4.0; bracketName = "Critical"; bracketColor = "bg-red-500";
                reasons.push(`<li class="flex items-start"><i class="fa-solid fa-triangle-exclamation mt-1 mr-2 text-red-300"></i> Base: ${baseScore} (Critical)</li>`);
            } else if (effectiveQA < 90.0) {
                baseScore = 5.0; maxCap = 6.0; bracketName = "Below Exp."; bracketColor = "bg-orange-500";
                reasons.push(`<li class="flex items-start"><i class="fa-solid fa-triangle-exclamation mt-1 mr-2 text-orange-300"></i> Base: ${baseScore} (Below Exp.)</li>`);
            } else if (effectiveQA < 95.0) {
                baseScore = 7.0; maxCap = 8.0; bracketName = "Meets Exp."; bracketColor = "bg-blue-500";
                reasons.push(`<li class="flex items-start"><i class="fa-solid fa-check mt-1 mr-2 text-green-300"></i> Base: ${baseScore} (Meets Exp.)</li>`);
            } else if (effectiveQA < 100.0) {
                baseScore = 8.5; maxCap = 9.0; bracketName = "Exceeds Exp."; bracketColor = "bg-indigo-500";
                reasons.push(`<li class="flex items-start"><i class="fa-solid fa-check-double mt-1 mr-2 text-green-300"></i> Base: ${baseScore} (Exceeds Exp.)</li>`);
            } else {
                baseScore = 9.0; maxCap = 10.0; bracketName = "Best in Class"; bracketColor = "bg-purple-500";
                reasons.push(`<li class="flex items-start"><i class="fa-solid fa-crown mt-1 mr-2 text-yellow-300"></i> Base: ${baseScore} (Perfect)</li>`);
            }

            // 4. Calculate Multipliers
            let currentScore = baseScore;
            let teamMult = 0;
            let effortMult = parseFloat(individualEffortInput.value);

            if (currentWorkflow === 'kyc') {
                // KYC Team Logic
                teamMult = parseFloat(teamTatInput.value);
                let tText = teamMult === 0.5 ? "+0.5 (Exc.)" : (teamMult === 0 ? "0.0 (Tgt)" : "-1.0 (Poor)");
                reasons.push(`<li class="flex items-start"><i class="fa-solid fa-users mt-1 mr-2 text-indigo-300"></i> Team TAT: ${tText}</li>`);
            
            } else {
                // Monitoring Team Logic: 2 SLAs
                const sla1 = document.querySelector('input[name="sla1"]:checked').value;
                const sla2 = document.querySelector('input[name="sla2"]:checked').value;
                
                if (sla1 === 'met' && sla2 === 'met') {
                    teamMult = 0.5;
                    monitoringTeamResult.innerText = "Multiplier: +0.5 (Exc)";
                    monitoringTeamResult.className = "text-right text-xs font-bold text-green-600";
                    reasons.push(`<li class="flex items-start"><i class="fa-solid fa-users mt-1 mr-2 text-green-300"></i> Team: Met BOTH (+0.5)</li>`);
                } else if (sla1 === 'missed' && sla2 === 'missed') {
                    teamMult = -1.0;
                    monitoringTeamResult.innerText = "Multiplier: -1.0 (Poor)";
                    monitoringTeamResult.className = "text-right text-xs font-bold text-red-600";
                    reasons.push(`<li class="flex items-start"><i class="fa-solid fa-users mt-1 mr-2 text-red-300"></i> Team: Missed BOTH (-1.0)</li>`);
                } else {
                    teamMult = 0.0;
                    monitoringTeamResult.innerText = "Multiplier: 0.0 (Tgt)";
                    monitoringTeamResult.className = "text-right text-xs font-bold text-indigo-600";
                    reasons.push(`<li class="flex items-start"><i class="fa-solid fa-users mt-1 mr-2 text-indigo-300"></i> Team: Met ONE (0.0)</li>`);
                }
            }

            // Apply Team Mult
            currentScore += teamMult;

            // Apply Effort Mult
            currentScore += effortMult;
            let eText = effortMult === 1.0 ? "+1.0 (Top)" : (effortMult === 0 ? "0.0 (Std)" : "-1.0 (Low)");
            reasons.push(`<li class="flex items-start"><i class="fa-solid fa-fire-extinguisher mt-1 mr-2 text-indigo-300"></i> Effort: ${eText}</li>`);

            // 5. Apply Caps
            if (currentScore > maxCap) {
                currentScore = maxCap;
                reasons.push(`<li class="flex items-start"><i class="fa-solid fa-lock mt-1 mr-2 text-red-400"></i> Capped at ${maxCap.toFixed(1)} by QA.</li>`);
            }

            // Quality Floor (100% QA + >= Std Effort -> Min 9.0)
            if (inputQA === 100.0 && effortMult >= 0.0) {
                if (currentScore < 9.0) {
                    currentScore = 9.0;
                    reasons.push(`<li class="flex items-start"><i class="fa-solid fa-shield-halved mt-1 mr-2 text-blue-300"></i> Floor: 100% QA = Min 9.0</li>`);
                }
            }

            // Best in Class Check (100% QA + Max Mults)
            let isBestInClass = false;
            // 10 requires: 100% QA AND Max Multipliers (+1.5 total) -> 9.0 + 1.5 = 10.5 -> 10.0
            // If they have 100% QA but only +1.0 mults -> 9.0 + 1.0 = 10.0.
            // Framework says: "A score of 10 is reserved... must trigger: QA 100%, Multipliers +1.5".
            // So we must enforce that strict logic.
            
            if (Math.round(currentScore) === 10) {
                 if (inputQA === 100.0 && (teamMult + effortMult) === 1.5) {
                    isBestInClass = true;
                 } else {
                     // Even if it rounds to 10, if they don't have perfect stats, we cap at 9
                     // Wait, user asked for rounding. 
                     // If result is 9.5 -> rounds to 10. 
                     // But framework says 10 is reserved.
                     // I will enforce the cap at 9 if criteria not met, then round.
                     if (inputQA < 100.0 || (teamMult + effortMult) < 1.5) {
                         currentScore = Math.min(currentScore, 9.4); // Force rounding down to 9
                         reasons.push(`<li class="flex items-start"><i class="fa-solid fa-circle-info mt-1 mr-2 text-indigo-300"></i> 10 requires Max Multipliers.</li>`);
                     } else {
                         isBestInClass = true;
                     }
                 }
            }

            // 6. Rounding (Final Step)
            // Ensure bounds first
            currentScore = Math.max(1.0, Math.min(10.0, currentScore));
            
            // Apply Rounding
            let finalRoundedScore = Math.round(currentScore);
            
            // Update DOM
            scoreDisplay.innerText = finalRoundedScore; // No decimals
            
            // Add note about rounding
            if (currentScore !== finalRoundedScore) {
                reasons.push(`<li class="flex items-start"><i class="fa-solid fa-calculator mt-1 mr-2 text-slate-400"></i> Value ${currentScore.toFixed(1)} rounded to ${finalRoundedScore}.</li>`);
            }

            logicList.innerHTML = reasons.join('');
            
            badgeContainer.innerHTML = `
                <span class="${bracketColor} text-white px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider shadow-sm">${bracketName}</span>
            `;
            if (bonusApplied) {
                 badgeContainer.innerHTML += `<span class="bg-amber-500 text-white px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider shadow-sm"><i class="fa-solid fa-star mr-1"></i> Bonus</span>`;
            }

            if (isBestInClass) {
                unicornAnim.classList.remove('hidden');
            } else {
                unicornAnim.classList.add('hidden');
            }
        }

        function closeUnicorn() {
            unicornAnim.classList.add('hidden');
        }

        // Init
        switchWorkflow('kyc'); // Default
    </script>
</body>
</html>
